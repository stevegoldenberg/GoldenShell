<!-- Generated by prompt-architect -->

# Fix GoldenShell Cloud Development Infrastructure and Enable Web-Based Claude Code Sessions

## Objective

You are an AWS DevOps Engineer tasked with diagnosing and fixing the GoldenShell cloud development infrastructure. The system is designed to provide cloud-based Claude Code CLI sessions accessible from anywhere, similar to platforms like Coder or DevZero. The EC2 instance is currently being created but SSH access is failing, and we need to establish what services are actually running on the instance. Once fixed, the system should support persistent, web-accessible terminal sessions for remote development.

## Project Context

**Technology Stack:**
- Infrastructure: Terraform (AWS Provider ~> 5.0)
- Platform: AWS EC2 (Ubuntu 22.04)
- Networking: Tailscale VPN for secure access
- Pre-installed Tools: Claude Code CLI, GitHub CLI, AWS CLI
- State Management: S3 backend with DynamoDB locking
- Auto-shutdown: SystemD timer-based idle monitoring
- Backups: AWS DLM for EBS snapshots

**Current Architecture:**
- EC2 instance with encrypted EBS storage
- Security group allowing only Tailscale UDP (port 41641)
- IAM role for CloudWatch, SSM Parameter Store, and EC2 self-shutdown
- User-data script installing tools and configuring auto-shutdown
- Budget alerts and CloudWatch monitoring

**Known Issues:**
1. EC2 instance builds successfully but SSH access fails
2. Unknown what services are actually running on the instance
3. No web-based terminal access currently configured
4. Current setup relies on Tailscale VPN which may not be working properly

**Project Files:**
- `/Users/steve/Code/GoldenShell/terraform/main.tf` - Main infrastructure
- `/Users/steve/Code/GoldenShell/terraform/variables.tf` - Configuration variables
- `/Users/steve/Code/GoldenShell/terraform/user-data.sh` - Instance initialization script
- `/Users/steve/Code/GoldenShell/terraform/outputs.tf` - Terraform outputs
- `/Users/steve/Code/GoldenShell/terraform/backend.tf` - S3 state backend
- `/Users/steve/Code/GoldenShell/README.md` - Comprehensive documentation

## CRITICAL: Branch Safety

**IMPORTANT:** The current git branch is `main`. You MUST create a new feature branch before making any code changes:

```bash
git checkout -b feature/fix-cloud-infrastructure
```

Do NOT make any commits to the main branch.

## Phase 1: Discovery and Diagnosis

Before making any changes, you must thoroughly diagnose the current state:

### 1.1 Verify Current Infrastructure State

Ask the user these questions first (if they don't have answers, proceed with investigation):
- What error message do they see when attempting SSH connection?
- Have they checked if the instance is in the "running" state in AWS Console?
- Do they see the instance appearing in their Tailscale dashboard/app?
- What is the public IP address of the instance?
- Can they confirm their AWS credentials are properly configured (`aws sts get-caller-identity`)?

### 1.2 Check EC2 Instance Status

Execute these investigations:

```bash
# Get instance details
cd /Users/steve/Code/GoldenShell/terraform
terraform output -json

# Check instance state
aws ec2 describe-instances \
  --instance-ids $(terraform output -raw instance_id) \
  --query 'Reservations[0].Instances[0].[State.Name,PublicIpAddress,PrivateIpAddress]' \
  --output table

# Check instance status checks
aws ec2 describe-instance-status \
  --instance-ids $(terraform output -raw instance_id) \
  --include-all-instances
```

### 1.3 Examine User-Data Script Execution

Access instance logs through AWS Console or Systems Manager:

```bash
# Get console output (includes cloud-init logs)
aws ec2 get-console-output \
  --instance-id $(terraform output -raw instance_id) \
  --output text > /tmp/instance-console-output.txt

# Review the output for errors
cat /tmp/instance-console-output.txt
```

Key things to look for:
- Did cloud-init complete successfully?
- Are there errors in `/var/log/cloud-init-output.log`?
- Did Tailscale installation and authentication succeed?
- Did Claude Code CLI install properly?
- Are there any package installation failures?

### 1.4 Investigate Security Group and Network Configuration

```bash
# Check security group rules
aws ec2 describe-security-groups \
  --group-ids $(terraform output -raw security_group_id) \
  --output json

# Verify VPC and subnet configuration
aws ec2 describe-instances \
  --instance-ids $(terraform output -raw instance_id) \
  --query 'Reservations[0].Instances[0].[VpcId,SubnetId,PublicIpAddress,PrivateIpAddress]'
```

Issues to identify:
- Is port 22 (SSH) actually blocked as intended?
- Is there a route to internet gateway for public access?
- Does the subnet have auto-assign public IP enabled?

### 1.5 Test Tailscale Connectivity

If Tailscale is the problem:
- Check if Tailscale auth key is valid and retrievable from SSM
- Verify security group allows Tailscale UDP port 41641
- Check if instance appears in user's Tailscale dashboard

### 1.6 Document Findings

Create a diagnostic report summarizing:
- What's working correctly
- What's failing and why
- Root cause analysis for SSH access failure
- Current state of installed services

## Phase 2: Fix SSH Access Issues

Based on your diagnostic findings, implement fixes:

### 2.1 Emergency SSH Access (Temporary)

If debugging requires SSH access, temporarily add an SSH rule:

```bash
# Get your current public IP
MY_IP=$(curl -s https://checkip.amazonaws.com)

# Temporarily allow SSH from your IP
aws ec2 authorize-security-group-ingress \
  --group-id $(terraform output -raw security_group_id) \
  --protocol tcp \
  --port 22 \
  --cidr $MY_IP/32 \
  --group-rule-description "Temporary SSH for debugging"
```

Connect and investigate:
```bash
ssh -i ~/.ssh/goldenshell-key.pem ubuntu@$(terraform output -raw public_ip)

# Check key logs
sudo tail -100 /var/log/cloud-init-output.log
sudo tail -100 /var/log/user-data.log
sudo systemctl status tailscaled
sudo journalctl -u tailscaled --no-pager
```

**IMPORTANT:** Document your findings and remove the temporary SSH rule when done:
```bash
aws ec2 revoke-security-group-ingress \
  --group-id $(terraform output -raw security_group_id) \
  --protocol tcp \
  --port 22 \
  --cidr $MY_IP/32
```

### 2.2 Fix User-Data Script Issues

Common issues and fixes in `/Users/steve/Code/GoldenShell/terraform/user-data.sh`:

1. **Claude Code CLI Installation**
   - The current script uses `curl -fsSL https://claude.ai/install.sh | sh`
   - Verify this URL is correct (it may need updating)
   - Add error checking and logging

2. **Warp Terminal Installation**
   - This requires GUI and won't work on headless server
   - Remove or make optional with proper error handling

3. **Tailscale Authentication**
   - Verify SSM parameter retrieval works with IMDSv2
   - Add retry logic for AWS API calls
   - Ensure proper error handling

4. **Missing Dependencies**
   - Add `ec2-metadata` tool for auto-shutdown script
   - Install `netstat` or use `ss` for connection checking

Recommended improvements:
```bash
# Add better error handling
set -e  # Already present, good
set -o pipefail  # Add this for better error detection

# Add comprehensive logging
exec > >(tee /var/log/user-data.log | logger -t user-data -s 2>/dev/console) 2>&1

# Install ec2-metadata-mock or use AWS CLI for metadata
apt-get install -y ec2-instance-connect
```

### 2.3 Fix Auto-Shutdown Script

The auto-shutdown script references `ec2-metadata` which may not be installed:

```bash
# Replace ec2-metadata with AWS CLI or IMDS
REGION=$(curl -s http://169.254.169.254/latest/meta-data/placement/region)
INSTANCE_ID=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)
```

Replace `netstat` with `ss` (more modern):
```bash
RECENT_CONNECTIONS=$(ss -tn | grep ESTAB | grep -v ':22' | wc -l)
```

## Phase 3: Implement Web-Based Terminal Access

Now enhance the system to support web-accessible terminal sessions:

### 3.1 Choose Web Terminal Solution

Evaluate and implement one of:
- **ttyd** (recommended: lightweight, modern, WebSocket-based)
- **GoTTY** (good alternative, slightly older)
- **Wetty** (Node.js-based, more complex)

Recommended: **ttyd** with tmux

### 3.2 Add ttyd Installation to User-Data

Update `/Users/steve/Code/GoldenShell/terraform/user-data.sh`:

```bash
# Install tmux and mosh for persistent sessions
echo "Installing tmux and mosh..."
apt-get install -y tmux mosh

# Install ttyd for web-based terminal access
echo "Installing ttyd..."
TTYD_VERSION="1.7.7"
wget -q "https://github.com/tsl0922/ttyd/releases/download/${TTYD_VERSION}/ttyd.x86_64" -O /usr/local/bin/ttyd
chmod +x /usr/local/bin/ttyd

# Verify installation
ttyd --version
```

### 3.3 Configure ttyd as SystemD Service

Create secure ttyd service with authentication:

```bash
# Generate a random password for ttyd
TTYD_PASSWORD=$(openssl rand -base64 32)
echo "$TTYD_PASSWORD" > /root/.ttyd_password
chmod 600 /root/.ttyd_password

# Create systemd service
cat > /etc/systemd/system/ttyd.service << 'EOF'
[Unit]
Description=ttyd - Share terminal over the web
After=network.target

[Service]
Type=simple
User=root
ExecStart=/usr/local/bin/ttyd -p 7681 -i 0.0.0.0 --writable --credential ubuntu:$(cat /root/.ttyd_password) tmux new-session -A -s main
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable ttyd.service
systemctl start ttyd.service
```

### 3.4 Update Security Group for HTTPS/Web Access

Add HTTPS access to security group in `/Users/steve/Code/GoldenShell/terraform/main.tf`:

```hcl
resource "aws_security_group" "goldenshell" {
  name        = "goldenshell-sg"
  description = "Security group for GoldenShell development instance"
  vpc_id      = data.aws_vpc.selected.id

  # Tailscale UDP
  ingress {
    from_port   = 41641
    to_port     = 41641
    protocol    = "udp"
    cidr_blocks = ["0.0.0.0/0"]
    description = "Tailscale"
  }

  # Web terminal access (ttyd) - restrict to your IP for security
  ingress {
    from_port   = 7681
    to_port     = 7681
    protocol    = "tcp"
    cidr_blocks = var.allowed_web_access_cidrs
    description = "Web terminal access (ttyd)"
  }

  # Mosh UDP ports (for mobile shell)
  ingress {
    from_port   = 60000
    to_port     = 61000
    protocol    = "udp"
    cidr_blocks = var.allowed_web_access_cidrs
    description = "Mosh (mobile shell)"
  }

  # Allow all outbound traffic
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
    description = "All outbound traffic"
  }

  tags = {
    Name        = "goldenshell-sg"
    Project     = "GoldenShell"
    ManagedBy   = "Terraform"
  }
}
```

Add new variable to `/Users/steve/Code/GoldenShell/terraform/variables.tf`:

```hcl
variable "allowed_web_access_cidrs" {
  description = "CIDR blocks allowed to access web terminal (restrict to your IP for security)"
  type        = list(string)
  default     = ["0.0.0.0/0"]  # Change to your IP for better security
}

variable "enable_web_terminal" {
  description = "Enable web-based terminal access via ttyd"
  type        = bool
  default     = true
}
```

### 3.5 Add HTTPS with Let's Encrypt (Optional but Recommended)

For production use, add nginx reverse proxy with SSL:

```bash
# Install nginx and certbot
apt-get install -y nginx certbot python3-certbot-nginx

# Configure nginx reverse proxy for ttyd
cat > /etc/nginx/sites-available/ttyd << 'EOF'
server {
    listen 443 ssl http2;
    server_name _;

    # SSL configuration will be added by certbot

    location / {
        proxy_pass http://127.0.0.1:7681;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF

ln -s /etc/nginx/sites-available/ttyd /etc/nginx/sites-enabled/
systemctl restart nginx
```

**Note:** Let's Encrypt requires a domain name. Document this as optional.

### 3.6 Add Web Terminal Access to Outputs

Update `/Users/steve/Code/GoldenShell/terraform/outputs.tf`:

```hcl
output "web_terminal_url" {
  description = "URL to access web-based terminal"
  value       = var.enable_web_terminal ? "http://${aws_instance.goldenshell.public_ip}:7681" : "Web terminal not enabled"
}

output "web_terminal_password_command" {
  description = "Command to retrieve web terminal password"
  value       = "ssh ubuntu@<tailscale-hostname> 'sudo cat /root/.ttyd_password'"
}

output "mosh_connection_command" {
  description = "Command to connect via mosh (mobile shell)"
  value       = "mosh ubuntu@${aws_instance.goldenshell.public_ip}"
}
```

## Phase 4: Testing and Validation

### 4.1 Test Infrastructure Deployment

```bash
cd /Users/steve/Code/GoldenShell/terraform

# Validate Terraform configuration
terraform validate

# Check formatting
terraform fmt -check

# Plan changes
terraform plan -out=tfplan

# Apply changes
terraform apply tfplan
```

### 4.2 Verify Instance Initialization

Wait for user-data script to complete (5-10 minutes):

```bash
# Monitor instance status
watch -n 10 'aws ec2 describe-instance-status \
  --instance-ids $(terraform output -raw instance_id) \
  --query "InstanceStatuses[0].InstanceStatus.Status"'

# Check console output
aws ec2 get-console-output \
  --instance-id $(terraform output -raw instance_id) \
  --latest --output text
```

### 4.3 Test Connectivity Methods

Test each access method:

1. **Tailscale SSH:**
   ```bash
   # Check if instance appears in Tailscale
   tailscale status

   # Connect
   ssh ubuntu@<tailscale-hostname>
   ```

2. **Mosh (if configured):**
   ```bash
   mosh ubuntu@$(terraform output -raw public_ip)
   ```

3. **Web Terminal:**
   ```bash
   # Get the URL
   terraform output web_terminal_url

   # Open in browser and use credentials
   ```

### 4.4 Verify Installed Services

Once connected, verify all services:

```bash
# Check Claude Code CLI
claude --version

# Check GitHub CLI
gh --version

# Check Tailscale
sudo tailscale status

# Check ttyd
sudo systemctl status ttyd

# Check tmux
tmux list-sessions

# Check auto-shutdown monitoring
sudo systemctl status goldenshell-idle-monitor.timer
sudo journalctl -u goldenshell-idle-monitor.service -n 50
```

### 4.5 Test Auto-Shutdown

```bash
# Check current idle threshold
sudo cat /usr/local/bin/check-idle-shutdown.sh | grep IDLE_THRESHOLD

# Manually trigger check
sudo /usr/local/bin/check-idle-shutdown.sh

# View logs
sudo cat /tmp/last-activity
```

### 4.6 Test Persistence

Test that sessions persist across disconnections:

```bash
# Via web terminal: Start a long-running process in tmux
tmux new -s test
# Run: sleep 300

# Disconnect from browser
# Reconnect and verify process is still running
tmux attach -t test
```

## Phase 5: Documentation and Cleanup

### 5.1 Update README

Update `/Users/steve/Code/GoldenShell/README.md` with:
- New web terminal access instructions
- Mosh usage guide
- Troubleshooting section updates
- Security best practices for web access

Key sections to add:

```markdown
## Web-Based Terminal Access

GoldenShell now supports web-based terminal access via ttyd:

1. Get your web terminal URL:
   ```bash
   cd terraform
   terraform output web_terminal_url
   ```

2. Get your password:
   ```bash
   ssh ubuntu@<tailscale-hostname> 'sudo cat /root/.ttyd_password'
   ```

3. Open the URL in your browser and login with:
   - Username: ubuntu
   - Password: (from step 2)

## Using Mosh for Robust Connections

Mosh (mobile shell) provides better connectivity for unstable networks:

```bash
# Install mosh locally
brew install mosh  # macOS
apt install mosh   # Linux

# Connect
mosh ubuntu@$(terraform output -raw public_ip)
```

Benefits:
- Survives network changes and laptop sleep
- More responsive on high-latency connections
- Uses UDP ports 60000-61000
```

### 5.2 Create Migration Guide

Create `/Users/steve/Code/GoldenShell/MIGRATION.md`:

```markdown
# Migration Guide for Web Terminal Features

## What Changed

- Added web-based terminal access via ttyd
- Added mosh support for robust mobile connections
- Improved user-data script error handling
- Fixed auto-shutdown script dependencies
- Updated security group for web and mosh access

## Breaking Changes

None - all changes are backward compatible.

## New Variables

Add to your `terraform.tfvars`:

```hcl
allowed_web_access_cidrs = ["YOUR.IP.ADDRESS.HERE/32"]  # Restrict to your IP
enable_web_terminal      = true
```

## Updating

1. Pull latest changes
2. Update terraform.tfvars with new variables
3. Run: `terraform plan` to review changes
4. Run: `terraform apply` to apply changes
5. Wait 5-10 minutes for instance to reconfigure
```

### 5.3 Update Security Documentation

Update `/Users/steve/Code/GoldenShell/SECURITY.md`:

```markdown
## Web Terminal Security

The web terminal (ttyd) is protected by:

1. **Password Authentication**: Random password generated during setup
2. **IP Whitelisting**: Configure `allowed_web_access_cidrs` to restrict access
3. **TLS Encryption** (optional): Configure nginx + Let's Encrypt for HTTPS

## Best Practices

- Never use `0.0.0.0/0` for `allowed_web_access_cidrs` in production
- Rotate ttyd password regularly
- Enable HTTPS for production use
- Monitor access logs: `sudo journalctl -u ttyd -f`
- Consider using Tailscale for all access (most secure)
```

### 5.4 Create Troubleshooting Guide

Create `/Users/steve/Code/GoldenShell/TROUBLESHOOTING.md`:

```markdown
# Troubleshooting Guide

## SSH Access Fails

### Symptom
Cannot connect via SSH, connection times out or refused.

### Diagnosis
1. Check instance is running: `aws ec2 describe-instances --instance-ids <id>`
2. Check security group allows your access method
3. Check Tailscale status on both ends

### Solution
- For Tailscale: Verify instance appears in `tailscale status`
- For emergency access: Use emergency SSH rule (see README)
- Check user-data logs: `aws ec2 get-console-output --instance-id <id>`

## Web Terminal Not Loading

### Symptom
Cannot access web terminal at http://IP:7681

### Diagnosis
1. Check ttyd service: `sudo systemctl status ttyd`
2. Check firewall allows port 7681
3. Check your IP is in `allowed_web_access_cidrs`

### Solution
```bash
# Restart ttyd
sudo systemctl restart ttyd

# Check logs
sudo journalctl -u ttyd -n 100

# Verify port is listening
sudo ss -tlnp | grep 7681
```

## User-Data Script Failed

### Symptom
Services not installed or configured after instance launch.

### Diagnosis
```bash
# Via emergency SSH or Systems Manager
sudo tail -100 /var/log/cloud-init-output.log
sudo tail -100 /var/log/user-data.log

# Check if setup completed
ls -la /var/lib/goldenshell-setup-complete
```

### Solution
- Review logs for specific errors
- Common issues: Network timeouts, invalid auth keys, package conflicts
- Can manually re-run parts of user-data script
```

### 5.5 Create CHANGELOG Entry

Update `/Users/steve/Code/GoldenShell/CHANGELOG.md`:

```markdown
## [Unreleased]

### Added
- Web-based terminal access via ttyd with password authentication
- Mosh (mobile shell) support for robust connections over unstable networks
- Comprehensive troubleshooting documentation
- Migration guide for existing deployments

### Fixed
- SSH connectivity issues caused by Tailscale configuration
- User-data script missing dependencies (ec2-metadata, netstat)
- Auto-shutdown script compatibility with modern systems
- Claude Code CLI installation error handling

### Changed
- Improved error logging in user-data script
- Enhanced security group to support web terminal and mosh
- Updated README with web access instructions

### Security
- Added IP whitelisting for web terminal access
- Generated random passwords for ttyd authentication
- Documented HTTPS setup for production use
```

### 5.6 Final Checklist

Before completing, verify:

- [ ] All Terraform files are properly formatted (`terraform fmt`)
- [ ] Terraform configuration validates (`terraform validate`)
- [ ] User-data script has proper error handling
- [ ] Security groups are appropriately restrictive
- [ ] Documentation is complete and accurate
- [ ] CHANGELOG is updated
- [ ] All tests pass
- [ ] No sensitive information in code/docs
- [ ] Git commit messages are clear and descriptive

## Phase 6: Deployment and Handoff

### 6.1 Commit Changes

```bash
# Review all changes
git status
git diff

# Stage changes
git add terraform/
git add *.md

# Commit with descriptive message
git commit -m "$(cat <<'EOF'
Fix GoldenShell infrastructure and add web-based terminal access

This commit addresses SSH connectivity issues and adds comprehensive
web-based terminal capabilities for cloud development.

Changes:
- Fixed user-data script dependencies and error handling
- Added ttyd for web-based terminal access
- Added mosh support for robust mobile connections
- Improved security group configuration
- Enhanced auto-shutdown script compatibility
- Updated documentation with troubleshooting guides

Fixes: SSH access failures, Tailscale connectivity issues
Features: Web terminal, mosh support, improved monitoring

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

### 6.2 Create Pull Request

```bash
# Push feature branch
git push -u origin feature/fix-cloud-infrastructure

# Create PR with comprehensive description
gh pr create --title "Fix GoldenShell Infrastructure and Add Web Terminal" --body "$(cat <<'EOF'
## Summary

This PR fixes critical SSH connectivity issues in the GoldenShell cloud development infrastructure and adds web-based terminal access for conductor.build-like functionality.

### Problems Solved

- ✅ SSH access failures due to Tailscale configuration issues
- ✅ Missing dependencies in user-data script (ec2-metadata, proper logging)
- ✅ Auto-shutdown script compatibility issues
- ✅ No web-based access method for cloud development sessions

### New Features

- 🌐 **Web-based terminal access** via ttyd with password authentication
- 📱 **Mosh support** for robust connections over mobile/unstable networks
- 📚 **Comprehensive documentation** including troubleshooting guides
- 🔒 **Enhanced security** with IP whitelisting and authentication

### Technical Changes

**Infrastructure (`terraform/main.tf`):**
- Updated security group to support web terminal (port 7681)
- Added mosh UDP port range (60000-61000)
- New variables for web access configuration

**User-Data Script (`terraform/user-data.sh`):**
- Fixed missing dependencies
- Added ttyd installation and systemd service
- Improved error handling and logging
- Added tmux and mosh installation

**Documentation:**
- Updated README.md with web terminal instructions
- Created TROUBLESHOOTING.md guide
- Created MIGRATION.md for existing deployments
- Enhanced SECURITY.md with web terminal best practices

### Testing Performed

- [x] Terraform validate and plan successful
- [x] EC2 instance launches successfully
- [x] User-data script completes without errors
- [x] Tailscale connectivity established
- [x] Web terminal accessible and functional
- [x] Mosh connection successful
- [x] Auto-shutdown mechanism working
- [x] All documentation reviewed

### Security Considerations

- Web terminal protected by password authentication
- IP whitelisting recommended via `allowed_web_access_cidrs`
- TLS/HTTPS setup documented for production use
- No secrets exposed in code or logs

### Breaking Changes

None - all changes are backward compatible.

### Migration Notes

Existing deployments need to:
1. Add new variables to `terraform.tfvars`
2. Run `terraform apply` to update infrastructure
3. Wait 5-10 minutes for instance reconfiguration

See MIGRATION.md for details.

🤖 Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

### 6.3 Provide User Instructions

Create final summary for the user:

```markdown
# GoldenShell Fix Complete ✅

## What Was Fixed

1. **SSH Access Issues**
   - Diagnosed Tailscale connectivity problems
   - Fixed user-data script dependencies
   - Improved error handling and logging

2. **Web Terminal Access**
   - Installed and configured ttyd for web-based terminal
   - Added password authentication
   - Configured security groups for web access

3. **Enhanced Connectivity**
   - Added mosh support for robust mobile connections
   - Improved auto-shutdown script compatibility

## How to Deploy

1. Review the pull request: [Link will be shown after PR creation]

2. If approved, merge and deploy:
   ```bash
   git checkout main
   git pull origin main
   cd terraform
   terraform apply
   ```

3. Wait 5-10 minutes for instance setup to complete

4. Access your development environment:

   **Via Web Browser:**
   ```bash
   # Get URL
   terraform output web_terminal_url

   # Get password
   terraform output web_terminal_password_command
   ```

   **Via Mosh:**
   ```bash
   mosh ubuntu@$(terraform output -raw public_ip)
   ```

   **Via Tailscale:**
   ```bash
   ssh ubuntu@<tailscale-hostname>
   ```

## Next Steps

- Consider setting up HTTPS for production use (see SECURITY.md)
- Restrict `allowed_web_access_cidrs` to your IP for better security
- Configure Claude Code CLI with your API key
- Install additional development tools as needed

## Documentation

- See TROUBLESHOOTING.md if you encounter any issues
- See MIGRATION.md for upgrade instructions
- See README.md for complete usage guide
```

## Success Criteria

This task is complete when:

1. ✅ Root cause of SSH access failure identified and documented
2. ✅ SSH access working via at least one method (Tailscale, mosh, or emergency SSH)
3. ✅ Web-based terminal accessible via browser
4. ✅ All installed services verified working (Claude Code CLI, GitHub CLI, ttyd, tmux)
5. ✅ Auto-shutdown mechanism tested and functioning
6. ✅ Security groups properly configured and documented
7. ✅ Comprehensive documentation updated (README, TROUBLESHOOTING, SECURITY, CHANGELOG)
8. ✅ All changes committed to feature branch
9. ✅ Pull request created with detailed description
10. ✅ User can successfully access Claude Code sessions from web browser

## Important Notes

- **Security First**: Always prioritize security over convenience
- **Test Thoroughly**: Verify each component works before moving to next phase
- **Document Everything**: Future users will thank you
- **Ask Questions**: If user input needed, ask before making assumptions
- **Be Explicit**: Show exact commands and expected outputs
- **Clean Code**: Follow Terraform best practices and style guidelines

## Resources

- AWS EC2 User-Data Logs: `/var/log/cloud-init-output.log`
- Terraform AWS Provider Docs: https://registry.terraform.io/providers/hashicorp/aws/latest/docs
- ttyd Documentation: https://tsl0922.github.io/ttyd/
- Mosh Documentation: https://mosh.org
- Tailscale Docs: https://tailscale.com/kb/
- tmux Guide: https://github.com/tmux/tmux/wiki
